<Window
    x:Class="BlueMeter.WPF.Views.EncounterHistoryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vms="clr-namespace:BlueMeter.WPF.ViewModels"
    xmlns:ctrl="clr-namespace:BlueMeter.WPF.Controls"
    Title="Encounter History"
    Width="1050"
    Height="600"
    MinWidth="850"
    MinHeight="400"
    Style="{StaticResource TransparentWindow}"
    mc:Ignorable="d">

    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="0"
            GlassFrameThickness="0"
            ResizeBorderThickness="6"
            UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <b:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </b:EventTrigger>
    </b:Interaction.Triggers>

    <Border Style="{StaticResource ShadowWindowBorder}" Background="#ECEBE9">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <ctrl:Header Title="Encounter History" Grid.Row="0" />

            <!-- Content -->
            <Border Grid.Row="1" Margin="10" Background="White" CornerRadius="5" BorderBrush="#E5E5E5" BorderThickness="2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Toolbar -->
                    <Border Grid.Row="0" Background="#2297F4" Padding="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="10" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                Grid.Column="0"
                                Text="Recent Encounters"
                                Foreground="White"
                                FontWeight="Bold"
                                FontSize="14"
                                VerticalAlignment="Center" />

                            <Button
                                Grid.Column="2"
                                Content="Delete All"
                                Command="{Binding DeleteAllHistoryCommand}"
                                Padding="15,5"
                                Background="#DC3545"
                                Foreground="White"
                                FontWeight="Bold"
                                BorderThickness="0"
                                Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4"
                                                        Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#C82333" />
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter Property="Background" Value="#BD2130" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <Button
                                Grid.Column="4"
                                Content="Refresh"
                                Command="{Binding RefreshCommand}"
                                Style="{StaticResource AntButtonStyle}"
                                Padding="15,5" />
                        </Grid>
                    </Border>

                    <!-- Encounter List -->
                    <DataGrid
                        Grid.Row="1"
                        ItemsSource="{Binding Encounters}"
                        SelectedItem="{Binding SelectedEncounter}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        CanUserDeleteRows="False"
                        IsReadOnly="True"
                        SelectionMode="Single"
                        HeadersVisibility="Column"
                        GridLinesVisibility="Horizontal"
                        HorizontalGridLinesBrush="#E5E5E5"
                        RowHeight="35"
                        AlternatingRowBackground="#F9F9F9"
                        MouseDoubleClick="DataGrid_MouseDoubleClick">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Start Time" Binding="{Binding FormattedStartTime}" Width="150" />
                            <DataGridTextColumn Header="Target/Boss" Binding="{Binding BossName}" Width="150" />
                            <DataGridTextColumn Header="Duration" Binding="{Binding FormattedDuration}" Width="80" />
                            <DataGridTextColumn Header="Players" Binding="{Binding PlayerCount}" Width="70" />
                            <DataGridTextColumn Header="Total Damage" Binding="{Binding FormattedTotalDamage}" Width="120" />
                            <DataGridTextColumn Header="Total Healing" Binding="{Binding FormattedTotalHealing}" Width="120" />
                            <DataGridTextColumn Header="Status" Binding="{Binding IsActive, Converter={StaticResource BoolToActiveStatusConverter}}" Width="80" />
                        </DataGrid.Columns>

                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#F5F5F5" />
                                <Setter Property="Foreground" Value="#333" />
                                <Setter Property="FontWeight" Value="Bold" />
                                <Setter Property="Padding" Value="10,8" />
                                <Setter Property="BorderBrush" Value="#E5E5E5" />
                                <Setter Property="BorderThickness" Value="0,0,1,1" />
                            </Style>
                            <Style TargetType="DataGridCell">
                                <Setter Property="Padding" Value="10,5" />
                                <Setter Property="BorderThickness" Value="0" />
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD" />
                                        <Setter Property="Foreground" Value="#000" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F0F0F0" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.Resources>
                    </DataGrid>

                    <!-- Status Bar -->
                    <Border Grid.Row="2" Background="#F5F5F5" BorderBrush="#E5E5E5" BorderThickness="0,1,0,0" Padding="10,5">
                        <Grid>
                            <TextBlock
                                Text="{Binding StatusMessage}"
                                VerticalAlignment="Center"
                                Foreground="#666" />

                            <ProgressBar
                                Width="200"
                                Height="20"
                                HorizontalAlignment="Right"
                                IsIndeterminate="True"
                                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}" />
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Footer -->
            <Border Grid.Row="2" Height="50" Background="#F5F5F5" BorderBrush="#E5E5E5" BorderThickness="0,1,0,0">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="10" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button
                        Grid.Column="1"
                        Content="Load Selected"
                        Command="{Binding LoadSelectedEncounterCommand}"
                        Style="{StaticResource AntPrimaryButtonStyle}"
                        Padding="20,8"
                        IsEnabled="{Binding SelectedEncounter, Converter={StaticResource NullToBoolConverter}}" />

                    <Button
                        Grid.Column="3"
                        Content="Close"
                        Command="{Binding CloseCommand}"
                        Style="{StaticResource AntButtonStyle}"
                        Padding="20,8" />
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
